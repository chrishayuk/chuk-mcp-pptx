# Keynote Compatibility Issue

## Problem
Apple Keynote shows "The file format is invalid" when opening PowerPoint files generated by python-pptx.

## Root Cause
This is a known compatibility issue between python-pptx and Keynote. The files are valid PowerPoint files (they open fine in Microsoft PowerPoint and LibreOffice), but Keynote has stricter requirements.

## Known Issues with Keynote
1. **Chart embedding** - Keynote doesn't handle Excel-embedded chart data the same way as PowerPoint
2. **XML namespaces** - Keynote expects specific XML namespace declarations
3. **Feature support** - Some PowerPoint features created by python-pptx aren't supported in Keynote

## Solutions

### Option 1: Use PowerPoint or PowerPoint Online
The files work correctly in:
- Microsoft PowerPoint (Windows/Mac)
- PowerPoint Online (free web version)
- LibreOffice Impress
- Google Slides (via import)

### Option 2: Create Keynote-Compatible Mode
We can add a compatibility mode that creates simpler presentations without charts:

```python
# Set compatibility mode
os.environ["PPTX_KEYNOTE_COMPAT"] = "true"
```

### Option 3: Convert Through PowerPoint
1. Open the file in PowerPoint Online (free)
2. Save/Download as PowerPoint
3. The re-saved file should open in Keynote

### Option 4: Use Alternative Chart Method
Instead of embedded charts, we could:
- Generate chart images using matplotlib
- Insert them as pictures
- This would be Keynote-compatible

## Workaround for Testing

For now, to verify the presentations are working:

1. **Upload to OneDrive/Google Drive**
   - Open in PowerPoint Online (free)
   - Or import to Google Slides

2. **Use LibreOffice Impress** (free)
   ```bash
   brew install --cask libreoffice
   ```

3. **Check file contents programmatically**
   ```bash
   uv run python -c "from pptx import Presentation; p=Presentation('chart_gallery.pptx'); print(f'Slides: {len(p.slides)}')"
   ```

## Technical Details

The issue is specifically with how python-pptx generates:
- Chart XML (`/ppt/charts/chart1.xml`)
- Chart relationships (`/ppt/charts/_rels/chart1.xml.rels`)
- Embedded Excel data (`/ppt/embeddings/Microsoft_Excel_Worksheet1.xlsx`)

Keynote expects these in a slightly different format than what python-pptx produces.

## Future Enhancement

We could add a Keynote compatibility mode that:
1. Avoids using embedded charts
2. Uses simpler slide layouts
3. Generates chart images instead of embedded charts
4. Ensures all XML follows Keynote's stricter requirements

This would require significant changes to the chart generation code.